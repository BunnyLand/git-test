# git-test
Git repository containing the web service code for GitHub screening exercise - Part 2
It is a REST api implemented using node.js + express. The api code is in the folder **git-test-api**

Following use case are implemented:

**1. Read webhook respnose:**

The api consumed the webhook respnose trigered on a GitHub repository / branch creation.

**2. Enable protection on the master branch of the newly created Git repository:**

The api uses the webhook data and triggers GitHub "Update branch protection" api to enable the protection on the master branch of newly created repository.

**3. Create an issue about that master branch was not protected on the repository and assign to self.**

Using the GitHub "Create Issue" api



Steps
Note

- The oAuth token is disabled by me, you can use your own oAuth token generated in the User --> Settings
- Only rest api with https support can be deployed behind API/ML, make sure to enable https support in your rest api.
- This express app, has https enabled already.

**PART I: Download & Build on local**
  
Method 1: From github
1) **Clone the repository**, install node packages and verify routes locally

//on local

git clone https://github.com/BunnyLand/git-test.git

cd git-test

npm install

npm start

Open your local browser and verify the git-test is working by accessing:

(http://localhost:8085/api/webhook-respnose)

Status:200 OK, can not Get /webhook-respnose

**To test the api using cURL:**
curl --location --request POST 'http://localhost:8085/api/webhook-respnose/' \
--header 'Content-Type: application/json' \
--data-raw '{
  "ref": "main",
  "ref_type": "branch",
  "master_branch": "main",
  "description": "this is test repository for GitHub exercise ",
  "pusher_type": "user",
  "repository": {
    "id": 12345xxx,
    "node_id": "123445xxxxx=",
    "name": "repo-name",
    "full_name": "org-name/repo-name",
    "url": "https://api.github.com/repos/org-name/repo-name",
    "default_branch": "main"
  }
}'


**Transfer project files from local to remote host:**

Note:

a. The node_modules folder will not be transferred, we can do npm install later on remote server itself to pull down required node packages

cd git-test

npm run build

For the next step, ensure that you have node installed on machine and your PATH includes nodejs/bin directory. Copy the build using scp to the target deployment location.


**Deploy on heroku cloud:**
I have deployed on the heroku cloud.

The high leve steps are as following:

- Install git on mac
- Install heroku cli on mac
- brew install heroku/brew/heroku
- Use the heroku login command to log in to the Heroku CLI. This authentication is required for both the heroku and git commands to work correctly.
- Check node version $ node --version . Should >10
- Check npm version: $ npm --version
- Check git version $ npm --version
- Prepare the app:
- To clone a local version of the sample application that you can then deploy to Heroku, execute the following commands in your local command shell or terminal:
- $ git clone https://github.com/heroku/node-js-getting-started.git
- $ cd node-js-getting-started
- Replace app.js with your app.js
- Deploy the app:
- Create an app on Heroku, which prepares Heroku to receive your source code.
- $ heroku create
- Now deploy your code:
- $ git push heroku main , it will trigger the build and deploy pipeline of heroku
- The application is now deployed. Ensure that at least one instance of the app is running:
- heroku ps:scale web=1
- Now visit the app at the URL generated by its app name. As a handy shortcut, you can open the ap as follows:
- $ heroku open
- View information about your running app using one of the logging commands, 
- $ heroku logs --tail

Further reading:
https://devcenter.heroku.com/articles/getting-started-with-nodejs

**My deployed api is running here:**

https://glacial-woodland-58479.herokuapp.com/api/webhook-respnose/


**Further improvements:**

- Refactor the code to make it modular
- Container based deployment using dockerfile
- add an additional authantication layer on the api.

